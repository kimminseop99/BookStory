<html layout:decorate="~{layout/layout}">
<div layout:fragment="content">
    <div class="max-w-7xl mx-auto p-6">


        <!-- ✅ 슬라이드 컨테이너 크기 조정 -->
        <div class="swiper-container my-10 max-w-5xl mx-auto">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">BookStory 추천 도서</h2>
            <div class="swiper-wrapper">

                <!-- ✅ 슬라이드 1개 (반복) -->
                <div th:each="book : ${recommendedBooks}" class="swiper-slide flex justify-center">
                    <div class="w-56 bg-white p-3 rounded-lg shadow-md">
                        <div class="w-full h-40 bg-gray-100 flex items-center justify-center rounded-md mb-2">
                            <img th:src="@{${book.imageUrl}}" alt="Book Cover" class="max-w-full max-h-full object-contain">
                        </div>
                        <h3 class="text-base font-semibold text-gray-800 text-center truncate" th:text="${book.title}">책 제목</h3>
                        <p class="text-gray-600 text-sm text-center" th:text="'저자: ' + ${book.author}">저자: 홍길동</p>
                        <p class="text-gray-500 text-xs mt-1 text-center line-clamp-2" th:text="${book.content}">책 설명</p>
                        <p class="text-blue-600 text-xs text-center mt-1" th:text="'#' + ${book.hashtags}">#해시태그</p>
                    </div>
                </div>
            </div>

        </div>

        <div class="flex justify-center flex-wrap gap-4 mb-6 mt-20" id="category-buttons">
            <button class="category-tab px-6 py-2 text-gray-800 font-medium border-b-4 border-blue-600 hover:border-blue-400 transition"
                    onclick="showCategory('fiction', this)">
                소설
            </button>
            <button class="category-tab px-6 py-2 text-gray-800 font-medium border-b-4 border-transparent hover:border-blue-400 transition"
                    onclick="showCategory('selfHelp', this)">
                자기계발
            </button>
            <button class="category-tab px-6 py-2 text-gray-800 font-medium border-b-4 border-transparent hover:border-blue-400 transition"
                    onclick="showCategory('science', this)">
                과학
            </button>
            <button class="category-tab px-6 py-2 text-gray-800 font-medium border-b-4 border-transparent hover:border-blue-400 transition"
                    onclick="showCategory('computer', this)">
                컴퓨터
            </button>
        </div>






        <!-- ✅ 카테고리별 슬라이더 컨테이너 -->
        <div class="space-y-10 my-10 max-w-5xl mx-auto">
            <!-- 카테고리: 소설 -->
            <div id="fiction" class="category-slider hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">소설</h2>
                <div class="swiper fiction-swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="book : ${fictionBooks}">
                            <div class="bg-white p-4 rounded-lg shadow-md">
                                <img th:src="@{${book.imageUrl}}" class="w-full h-64 object-contain rounded mb-3" alt="book cover">
                                <h3 class="text-lg font-semibold text-gray-800" th:text="${book.title}">제목</h3>
                                <p class="text-gray-600 text-sm" th:text="'저자: ' + ${book.author}">저자</p>
                                <p class="text-gray-500 text-sm mt-2" th:text="${book.content}">내용</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 카테고리: 자기계발-->
            <div id="selfHelp" class="category-slider hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">자기계발</h2>
                <div class="swiper selfHelp-swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="book : ${selfHelpBooks}">
                            <div class="bg-white p-4 rounded-lg shadow-md">
                                <img th:src="@{${book.imageUrl}}" class="w-full h-64 object-contain rounded mb-3" alt="book cover">
                                <h3 class="text-lg font-semibold text-gray-800" th:text="${book.title}">제목</h3>
                                <p class="text-gray-600 text-sm" th:text="'저자: ' + ${book.author}">저자</p>
                                <p class="text-gray-500 text-sm mt-2" th:text="${book.content}">내용</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 카테고리: 과학-->
            <div id="science" class="category-slider hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">과학</h2>
                <div class="swiper science-swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="book : ${scienceBooks}">
                            <div class="bg-white p-4 rounded-lg shadow-md">
                                <img th:src="@{${book.imageUrl}}" class="w-full h-64 object-contain rounded mb-3" alt="book cover">
                                <h3 class="text-lg font-semibold text-gray-800" th:text="${book.title}">제목</h3>
                                <p class="text-gray-600 text-sm" th:text="'저자: ' + ${book.author}">저자</p>
                                <p class="text-gray-500 text-sm mt-2" th:text="${book.content}">내용</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 카테고리: 컴퓨터-->
            <div id="computer" class="category-slider hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">컴퓨터</h2>
                <div class="swiper computer-swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="book : ${computerBooks}">
                            <div class="bg-white p-4 rounded-lg shadow-md">
                                <img th:src="@{${book.imageUrl}}" class="w-full h-64 object-contain rounded mb-3" alt="book cover">
                                <h3 class="text-lg font-semibold text-gray-800" th:text="${book.title}">제목</h3>
                                <p class="text-gray-600 text-sm" th:text="'저자: ' + ${book.author}">저자</p>
                                <p class="text-gray-500 text-sm mt-2" th:text="${book.content}">내용</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
           new Swiper('.swiper-container', {
               loop: true,
               slidesPerView: 1,
               spaceBetween: 20,
               pagination: {
                   el: '.swiper-pagination',
                   clickable: true
               },
               navigation: {
                   nextEl: '.swiper-button-next',
                   prevEl: '.swiper-button-prev'
               },
               breakpoints: {
                   640: {
                       slidesPerView: 1,
                   },
                   768: {
                       slidesPerView: 2,
                   },
                   1024: {
                       slidesPerView: 3,
                   },
               }
           });
       });

       function encodeSearchQuery() {
           var queryInput = document.getElementById('searchQuery');
           queryInput.value = encodeURIComponent(queryInput.value);
       }

       window.addEventListener('pageshow', function (event) {
           if (event.persisted || window.performance && performance.navigation.type === 2) {
               document.getElementById('searchQuery').value = '';
           }
       });

         const swipers = {};

    function showCategory(categoryId, clickedBtn) {
    // 카테고리 슬라이더 숨김
    document.querySelectorAll('.category-slider').forEach(el => el.classList.add('hidden'));

    const target = document.getElementById(categoryId);
    if (target) {
        target.classList.remove('hidden');
    }

    // 모든 버튼 border 제거
    document.querySelectorAll('.category-tab').forEach(btn => {
        btn.classList.remove('border-blue-600');
        btn.classList.add('border-transparent');
    });

    // 클릭된 버튼에만 밑줄
    if (clickedBtn) {
        clickedBtn.classList.remove('border-transparent');
        clickedBtn.classList.add('border-blue-600');
    }

    // Swiper 초기화
    if (!swipers[categoryId]) {
        swipers[categoryId] = new Swiper(`.${categoryId}-swiper`, {
            loop: true,
            slidesPerView: 1,
            spaceBetween: 20,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            breakpoints: {
                768: { slidesPerView: 2 },
                1024: { slidesPerView: 3 },
            }
        });
    }
}

window.addEventListener('DOMContentLoaded', () => {
    const fictionBtn = document.querySelector("button[onclick*=\"showCategory('fiction'\"]");
    showCategory('fiction', fictionBtn);
});

    </script>
</div>
</html>